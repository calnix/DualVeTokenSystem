# 3. Credential Pools and Voting for Subsidies [veMOCA]

## Background

Verifiers receive esMOCA token subsidies proportional to their verification fee usage to incentivize network adoption.

I.e., they (might) be to claim a portion of their verification expenses in the form of cashback subsidies.

**Why might**

Distribution of subsidies is dictated by voting and FCFS claiming.

TLDR:

- Each unique schema type will have a corresponding voting pool on-chain
- veMOCA holders vote to allocate subsidies across the different pools
- Pools with more votes, get more subsidies
- Verifiers can claim subsidies, but on a first-come-first-served basis

Therefore, to claim subsidies, a verifier's credential pool must have received votes and thus allocated subsidies.
Additionally, said verifier must be early enough to claim said subsidies before other verifiers have claimed and exhausted the available supply.

If a credential pool receives no votes, verifiers using that schema will not receive any subsidies for their verification fees.

> The subsidy amount for verifiers is capped at their total verification fee payments, ensuring they cannot generate profit from the subsidy system

## Voting with veMOCA

- 28-day voting epochs [4 WEEKS]
- Users can split their votes across multiple credential pools
- Voters are rewarded. Those that do not vote, do not get rewards. [!voters_get_nothing_frm_subsidies]
- End-of-epoch snapshot determines veMOCA voting power distribution [done at the end of 28th day]

1 vote = 1 veMOCA.
At the end of epoch, each pool's vote counter needs to be reset.

### Voting Power

While users can call `vote` anytime during the epoch, the contract uses veMoca balance at the epoch’s start (via balanceOfAt) to determine voting power, ensuring decay is accounted for consistently.

**Therefore, whether the user votes at the start of the epoch or at the middle is immaterial; intra-epoch decay is regarded.**

## Vote Delegation

- Users can delegate veMOCA to others, who can vote on their behalf
- Open system allowing anyone to become a Delegate Leader
- Leaders earn commission (e.g. 10%) on verification fees from voted pools
- Flexible delegation allowing allocation to any available Leader

*Unclear*

```smlj
- Is the cut for vote delegation fixed?
- Can i delegate to multiple fellas at once?
```

- delegators set their fee pct
- when they wish to change their fees, it will be applied to the next epoch [or next epoch + 1; for buffer]
- no need for a global limit - free market will resolve itself.
    - hence: no need for delegator to declare their maximum; let delegators compete with each other in a free market

## Becoming a Delegate

- pay registration fee: `100 MOCA`
- registration fee goes to treasury
- fee is non-refundable in any circumstance; even if you stop being a delegate
- registration fee can be updated; but forward-looking

### Delegate setting fee

- no decimals; only integer pct values
- if increase, only applicable currentEpoch+2
- if decrease, applicable immediately

just so we both are clear about fees and claiming voting rewards:
1. delegator lowers fees in currentEpoch → therefore when claiming rewards in currentEpoch + 1; lowered fees will be applicable
2. delegator increases fees in  currentEpoch → new higher fees goes into effect in currentEpoch +2; but they would be applied on rewards given out in currentEpoch+3

## Distributing verification fees as rewards based on voting

For each pool, emissions received are calculated as:

`Emissions = (numOfVotesReceived / totalVotes) * totalEmissionsForPeriod`

- Total Emissions distributed can be different for each period; not fixed.
- Subsidies are distributed as esMoca

## Claiming Subsidies

- somehow there exists a contract which is updated each time a Verifier makes a verification
- this contract tracks the total amount of verification fees paid per credential schema, for each voting epoch.
- based on this total amount, each verifier can claim a % amount in subsidies.
- claiming wil be on a FCFS basis till all allocated subsidies for that pool has been depleted

### What if there is surplus subsidies?

Claimable by treasury after 6 epochs

- set deadline in number of epochs
- deadline can be updatable
- applicable to base and bonus

## Validators can participate in voting

- Validators can stake esMoca to receive veMOCA [esMOCA treated as Moca]
- Validators can then vote with veMOCA

---

# ADD NOTES

# Emissions per epoch. 
lets talk about pool emissions.

## 1. pool emissions
For each pool, emissions received are calculated as:

`Emissions = (numOfVotesReceived / totalVotes) * totalEmissionsForPeriod`

- Total Emissions distributed can be different for each period; not fixed.
- admin will set the amount of emissions for epoch in advance [use mapping to track]
- emissions are subsidies which are distributed as esMoca
- these will go to verifiers 

## 2. Claiming base Subsidies
-  there exists a contract which is updated each time a Verifier makes a verification
- this contract tracks the total amount of verification fees paid per credential schema, for each voting epoch.
- based on this total amount, each verifier can claim a % amount in subsidies.
- claiming will be on a FCFS basis till all allocated subsidies for that pool has been depleted
- Verifiers will only be able to claim the subsidy in $esMOCA at the end of an epoch
- ideally, Verifiers to claim subsidy from multiple credential pools in 1 transaction
- **Viewing Eligible Subsidy**: Verifiers will be able to see how much subsidy they are eligible to claim from each credential pool in each epoch